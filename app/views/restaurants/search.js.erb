var map, pointArray, heatmap;
var heatmapData = [
  <% @coordinates.each do |venue| %>
    new google.maps.LatLng(<%= venue[0] %>, <%= venue[1] %>),
  <% end %>
  ];


function initialize() {
  var cuisine = "<%= @search.cuisine%>";
  restaurantCount(cuisine);
  var mapOptions = {
    zoom: 11,
    center: new google.maps.LatLng(40.7, -73.9),
    mapTypeId: google.maps.MapTypeId.MAP
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  var pointArray = new google.maps.MVCArray(heatmapData);
  
  heatmap = new google.maps.visualization.HeatmapLayer({
    data: pointArray
    
  });

  heatmap.setMap(map);

  var pinLocation = new google.maps.LatLng(40.7, -73.9)
  marker = new google.maps.Marker({
    position: pinLocation,
    title:"Hello World!",
    animation: google.maps.Animation.DROP
  });
}

function restaurantCount(cuisine){
  var count = "<%= @coordinates.count %>";
  $("span.count").text(cuisine + ": " + count)
}

function toggleHeatmap() {
  
  heatmap.setMap(heatmap.getMap() ? null : map);

}

function changeGradient() {
  var gradient = [
    'rgba(0, 255, 255, 0)',
    'rgba(0, 255, 255, 1)',
    'rgba(0, 191, 255, 1)',
    'rgba(0, 127, 255, 1)',
    'rgba(0, 63, 255, 1)',
    'rgba(0, 0, 255, 1)',
    'rgba(0, 0, 223, 1)',
    'rgba(0, 0, 191, 1)',
    'rgba(0, 0, 159, 1)',
    'rgba(0, 0, 127, 1)',
    'rgba(63, 0, 91, 1)',
    'rgba(127, 0, 63, 1)',
    'rgba(191, 0, 31, 1)',
    'rgba(255, 0, 0, 1)'
  ]
  heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

function changeRadius() {
  heatmap.set('radius', heatmap.get('radius') ? null : 20);
}

function changeOpacity() {
  heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
}

function dropPin(){
  marker.setMap(map);
}

function changeShowClass(){
  dropPins();
  $('span#show-pins-btn').addClass("hidden")
  $('span#hide-pins-btn').removeClass('hidden')
} 

function changeHideClass(){
  hidePins();
  $('span#hide-pins-btn').addClass('hidden')
  $('span#show-pins-btn').removeClass('hidden')
} 

function dropPins(){
  marker.setMap(map);
}

function hidePins(){
  marker.setMap(null);
}

initialize();
